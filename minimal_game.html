<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Swimming Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }
        #game-container {
            border: 3px solid #66ccff;
            border-radius: 12px;
            background: #000;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script>
        console.log('Starting minimal game...');
        
        class MenuScene extends Phaser.Scene {
            constructor() {
                super({ key: 'MenuScene' });
            }
            
            create() {
                console.log('MenuScene created');
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // Background
                this.add.rectangle(width/2, height/2, width, height, 0x0066cc);
                
                // Title
                this.add.text(width/2, height/2 - 100, 'SWIMMING GAME', {
                    fontSize: '48px',
                    fill: '#ffffff',
                    stroke: '#000000',
                    strokeThickness: 4
                }).setOrigin(0.5);
                
                // Start button
                const startButton = this.add.rectangle(width/2, height/2 + 50, 200, 60, 0x00ff00);
                const startText = this.add.text(width/2, height/2 + 50, 'START RACE', {
                    fontSize: '24px',
                    fill: '#000000'
                }).setOrigin(0.5);
                
                startButton.setInteractive();
                startButton.on('pointerdown', () => {
                    console.log('Starting race...');
                    this.scene.start('RaceScene');
                });
            }
        }
        
        class RaceScene extends Phaser.Scene {
            constructor() {
                super({ key: 'RaceScene' });
            }
            
            create() {
                console.log('RaceScene created');
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // Pool background
                this.add.rectangle(width/2, height/2, width, height, 0x0066cc);
                
                // Pool lanes
                const laneHeight = height / 6;
                for (let i = 1; i < 6; i++) {
                    const y = i * laneHeight;
                    for (let x = 0; x < width; x += 20) {
                        this.add.rectangle(x + 10, y, 10, 2, 0xffffff);
                    }
                }
                
                // Start and finish lines
                this.add.rectangle(80, height/2, 4, height, 0x00ff00);
                this.add.rectangle(width - 80, height/2, 4, height, 0xff0000);
                
                // Swimmers
                this.swimmers = [];
                for (let i = 0; i < 6; i++) {
                    const y = (i + 0.5) * laneHeight;
                    const swimmer = this.add.circle(80, y, 15, i === 2 ? 0xffff00 : 0xff6666);
                    this.swimmers.push({
                        sprite: swimmer,
                        speed: 50 + Math.random() * 50,
                        isPlayer: i === 2
                    });
                }
                
                // Instructions
                this.add.text(width/2, height - 50, 'Press SPACE to dive, then LEFT/RIGHT to swim!', {
                    fontSize: '18px',
                    fill: '#ffffff',
                    stroke: '#000000',
                    strokeThickness: 2
                }).setOrigin(0.5);
                
                // Input
                this.cursors = this.input.keyboard.createCursorKeys();
                this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
                
                this.raceStarted = false;
                this.playerDived = false;
                this.expectedKey = 'left';
            }
            
            update() {
                if (!this.raceStarted && Phaser.Input.Keyboard.JustDown(this.spaceKey)) {
                    this.raceStarted = true;
                    this.playerDived = true;
                    console.log('Race started!');
                }
                
                if (this.raceStarted) {
                    // Move AI swimmers
                    this.swimmers.forEach(swimmer => {
                        if (!swimmer.isPlayer) {
                            swimmer.sprite.x += swimmer.speed * 0.016;
                        }
                    });
                    
                    // Player movement
                    const player = this.swimmers.find(s => s.isPlayer);
                    if (this.playerDived) {
                        if (this.expectedKey === 'left' && Phaser.Input.Keyboard.JustDown(this.cursors.left)) {
                            player.sprite.x += 20;
                            this.expectedKey = 'right';
                        } else if (this.expectedKey === 'right' && Phaser.Input.Keyboard.JustDown(this.cursors.right)) {
                            player.sprite.x += 20;
                            this.expectedKey = 'left';
                        }
                    }
                    
                    // Check finish
                    this.swimmers.forEach(swimmer => {
                        if (swimmer.sprite.x >= this.cameras.main.width - 100) {
                            console.log('Race finished!');
                            this.scene.start('MenuScene');
                        }
                    });
                }
            }
        }
        
        const config = {
            type: Phaser.AUTO,
            width: 1280,
            height: 720,
            parent: 'game-container',
            backgroundColor: '#000000',
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            scene: [MenuScene, RaceScene]
        };
        
        console.log('Creating game with config:', config);
        const game = new Phaser.Game(config);
        console.log('Game instance:', game);
    </script>
</body>
</html>